---
globs: *.ts,*.js,*.json
description: ν”„λ΅μ νΈ κµ¬μ΅° λ° νμΌ λ…λ… κ·μΉ™
---

# ν”„λ΅μ νΈ κµ¬μ΅° κ·μΉ™

## π“ λ””λ ‰ν† λ¦¬ κµ¬μ΅°

```
memento/
β”β”€β”€ src/                    # μ†μ¤ μ½”λ“
β”‚   β”β”€β”€ algorithms/        # κ²€μƒ‰ λ° λ§κ° μ•κ³ λ¦¬μ¦
β”‚   β”‚   β”β”€β”€ search-engine.ts    # κ²€μƒ‰ μ—”μ§„ κµ¬ν„
β”‚   β”‚   β””β”€β”€ search-ranking.ts   # κ²€μƒ‰ λ­ν‚Ή μ•κ³ λ¦¬μ¦
β”‚   β”β”€β”€ client/            # MCP ν΄λΌμ΄μ–ΈνΈ
β”‚   β”‚   β””β”€β”€ index.ts       # ν΄λΌμ΄μ–ΈνΈ μ§„μ…μ 
β”‚   β”β”€β”€ config/            # μ„¤μ • κ΄€λ¦¬
β”‚   β”‚   β””β”€β”€ index.ts       # μ„¤μ • νμΌ
β”‚   β”β”€β”€ database/          # λ°μ΄ν„°λ² μ΄μ¤ κ΄€λ ¨
β”‚   β”‚   β”β”€β”€ init.ts        # λ°μ΄ν„°λ² μ΄μ¤ μ΄κΈ°ν™”
β”‚   β”‚   β””β”€β”€ schema.sql     # SQLite μ¤ν‚¤λ§
β”‚   β”β”€β”€ server/            # MCP μ„λ²„
β”‚   β”‚   β””β”€β”€ index.ts       # μ„λ²„ μ§„μ…μ  (432μ¤„)
β”‚   β”β”€β”€ tools/             # MCP Tools κµ¬ν„ (λΉ ν΄λ”)
β”‚   β”β”€β”€ types/             # TypeScript νƒ€μ… μ •μ
β”‚   β”‚   β””β”€β”€ index.ts       # κ³µν†µ νƒ€μ… μ •μ
β”‚   β”β”€β”€ utils/             # μ ν‹Έλ¦¬ν‹° ν•¨μ
β”‚   β”‚   β””β”€β”€ database.ts    # λ°μ΄ν„°λ² μ΄μ¤ μ ν‹Έλ¦¬ν‹°
β”‚   β”β”€β”€ test-client.ts     # ν΄λΌμ΄μ–ΈνΈ ν…μ¤νΈ (152μ¤„)
β”‚   β””β”€β”€ test-search.ts     # κ²€μƒ‰ ν…μ¤νΈ (152μ¤„)
β”β”€β”€ dist/                  # λΉλ“ κ²°κ³Όλ¬Ό
β”‚   β”β”€β”€ algorithms/        # μ»΄νμΌλ μ•κ³ λ¦¬μ¦
β”‚   β”β”€β”€ client/           # μ»΄νμΌλ ν΄λΌμ΄μ–ΈνΈ
β”‚   β”β”€β”€ config/           # μ»΄νμΌλ μ„¤μ •
β”‚   β”β”€β”€ database/         # μ»΄νμΌλ λ°μ΄ν„°λ² μ΄μ¤
β”‚   β”β”€β”€ server/           # μ»΄νμΌλ μ„λ²„
β”‚   β”β”€β”€ types/            # μ»΄νμΌλ νƒ€μ…
β”‚   β””β”€β”€ utils/            # μ»΄νμΌλ μ ν‹Έλ¦¬ν‹°
β”β”€β”€ data/                 # λ°μ΄ν„° νμΌ
β”‚   β”β”€β”€ memory.db         # SQLite λ°μ΄ν„°λ² μ΄μ¤
β”‚   β”β”€β”€ memory.db-shm     # SQLite κ³µμ  λ©”λ¨λ¦¬
β”‚   β””β”€β”€ memory.db-wal     # SQLite WAL νμΌ
β”β”€β”€ docs/                 # λ¬Έμ„
β”β”€β”€ .cursor/rules/        # Cursor κ°λ° κ·μΉ™
β”β”€β”€ package.json          # ν”„λ΅μ νΈ μ„¤μ •
β”β”€β”€ tsconfig.json         # TypeScript μ„¤μ •
β”β”€β”€ vitest.config.ts      # Vitest μ„¤μ •
β””β”€β”€ env.example           # ν™κ²½ λ³€μ μμ‹
```

## π“ νμΌ λ…λ… κ·μΉ™

### TypeScript νμΌ
- **μ»΄ν¬λ„νΈ**: PascalCase (μ: `MemoryManager.ts`)
- **μ ν‹Έλ¦¬ν‹°**: kebab-case (μ: `search-ranking.ts`)
- **νƒ€μ… μ •μ**: `types.ts` λλ” `interfaces.ts`
- **μƒμ**: `constants.ts` λλ” `config.ts`

### ν…μ¤νΈ νμΌ
- **λ‹¨μ„ ν…μ¤νΈ**: `*.test.ts`
- **ν†µν•© ν…μ¤νΈ**: `*.integration.test.ts`
- **E2E ν…μ¤νΈ**: `*.e2e.test.ts`
- **ν”½μ¤μ²**: `*.fixture.ts`
- **ν…μ¤νΈ μ¤ν¬λ¦½νΈ**: `test-*.ts` (μ: `test-client.ts`, `test-search.ts`)

### μ„¤μ • νμΌ
- **ν™κ²½λ³„**: `.env.development`, `.env.production`
- **λΉλ“**: `webpack.config.js`, `tsconfig.json`
- **Docker**: `Dockerfile`, `docker-compose.yml`

## π—οΈ λ¨λ“ κµ¬μ΅°

### MCP μ„λ²„ λ¨λ“
```typescript
// src/server/tools/remember.ts
export class RememberTool {
  async execute(params: RememberParams): Promise<RememberResult> {
    // κµ¬ν„
  }
}

// src/server/tools/index.ts
export { RememberTool } from './remember';
export { RecallTool } from './recall';
// ... λ‹¤λ¥Έ λ„κµ¬λ“¤
```

### ν΄λΌμ΄μ–ΈνΈ λ¨λ“
```typescript
// src/client/memory-manager.ts
export class MemoryManager {
  constructor(private client: MCPClient) {}
  
  async remember(content: string, options?: RememberOptions): Promise<string> {
    // κµ¬ν„
  }
}
```

### μ•κ³ λ¦¬μ¦ λ¨λ“
```typescript
// src/algorithms/search-ranking.ts
export class SearchRanking {
  calculateScore(features: SearchFeatures): number {
    // κµ¬ν„
  }
}
```

## π”— μμ΅΄μ„± κ΄€λ¦¬

### λ‚΄λ¶€ μμ΅΄μ„±
- **μ„λ²„ β†’ κ³µν†µ**: `src/server` β†’ `src/shared`
- **ν΄λΌμ΄μ–ΈνΈ β†’ κ³µν†µ**: `src/client` β†’ `src/shared`
- **μ•κ³ λ¦¬μ¦ β†’ κ³µν†µ**: `src/algorithms` β†’ `src/shared`

### μ™Έλ¶€ μμ΅΄μ„±
- **MCP SDK**: `@modelcontextprotocol/sdk`
- **λ°μ΄ν„°λ² μ΄μ¤**: `better-sqlite3` (M1), `pg` (M3+)
- **λ²΅ν„° κ²€μƒ‰**: `sqlite-vss` (M1), `pgvector` (M3+)
- **ν…μ¤νΈ**: `jest`, `@types/jest`

## π“¦ ν¨ν‚¤μ§€ κµ¬μ΅°

### package.json μ¤ν¬λ¦½νΈ
```json
{
  "scripts": {
    "dev": "tsx watch src/server/index.ts",
    "build": "tsc && npm run copy:assets",
    "copy:assets": "powershell -Command \"if (!(Test-Path 'dist/database')) { New-Item -ItemType Directory -Path 'dist/database' -Force }; Copy-Item 'src/database/schema.sql' 'dist/database/' -Force\"",
    "start": "node dist/server/index.js",
    "test": "vitest",
    "lint": "eslint src/**/*.ts",
    "type-check": "tsc --noEmit",
    "db:init": "tsx src/database/init.ts",
    "db:migrate": "tsx src/database/migrate.ts",
    "test:client": "tsx src/test-client.ts",
    "test:search": "tsx src/test-search.ts"
  }
}
```

### TypeScript μ„¤μ •
```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@/server/*": ["src/server/*"],
      "@/client/*": ["src/client/*"],
      "@/shared/*": ["src/shared/*"]
    }
  }
}
```

## π§ ν…μ¤νΈ κµ¬μ΅°

### λ‹¨μ„ ν…μ¤νΈ
```typescript
// tests/unit/memory-manager.test.ts
import { MemoryManager } from '@/client/memory-manager';

describe('MemoryManager', () => {
  let memoryManager: MemoryManager;
  
  beforeEach(() => {
    // ν…μ¤νΈ μ„¤μ •
  });
  
  it('should remember content', async () => {
    // ν…μ¤νΈ κµ¬ν„
  });
});
```

### ν†µν•© ν…μ¤νΈ
```typescript
// tests/integration/mcp-server.test.ts
import { MCPClient } from '@modelcontextprotocol/sdk';

describe('MCP Server Integration', () => {
  let client: MCPClient;
  
  beforeAll(async () => {
    // μ„λ²„ μ‹μ‘
  });
  
  afterAll(async () => {
    // μ„λ²„ μΆ…λ£
  });
});
```

## π³ Docker κµ¬μ΅°

### Dockerfile
```dockerfile
FROM node:20-alpine

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY dist/ ./dist/
EXPOSE 8080

CMD ["node", "dist/server/index.js"]
```

### docker-compose.yml
```yaml
version: '3.8'
services:
  memento-server:
    build: .
    ports:
      - "8080:8080"
    environment:
      - NODE_ENV=production
    volumes:
      - ./data:/app/data
```

## π“‹ μ½”λ“ μ΅°μ§ μ›μΉ™

### 1. λ‹¨μΌ μ±…μ„ μ›μΉ™
- κ° λ¨λ“μ€ ν•λ‚μ λ…ν™•ν• μ±…μ„μ„ κ°€μ Έμ•Ό ν•¨
- MCP Toolsλ” κ°κ° λ…λ¦½μ μΈ νμΌλ΅ λ¶„λ¦¬

### 2. μμ΅΄μ„± μ—­μ „
- κµ¬μ²΄μ μΈ κµ¬ν„λ³΄λ‹¤λ” μ¶”μƒν™”μ— μμ΅΄
- μΈν„°νμ΄μ¤λ¥Ό ν†µν• λμ¨ν• κ²°ν•©

### 3. μ„¤μ • λ¶„λ¦¬
- ν™κ²½λ³„ μ„¤μ •μ€ λ³„λ„ νμΌλ΅ κ΄€λ¦¬
- ν•λ“μ½”λ”©λ κ°’μ€ μƒμλ΅ λ¶„λ¦¬

### 4. μ—λ¬ μ²λ¦¬
- κ° λ μ΄μ–΄μ—μ„ μ μ ν• μ—λ¬ μ²λ¦¬
- μ‚¬μ©μ μΉν™”μ μΈ μ—λ¬ λ©”μ‹μ§€

### 5. λ΅κΉ…
- κµ¬μ΅°ν™”λ λ΅κΉ… μ‚¬μ©
- λ―Όκ°ν• μ •λ³΄λ” λ§μ¤ν‚Ή

## π”„ λ§μ΄κ·Έλ μ΄μ… κ°€μ΄λ“

### M1 β†’ M2
- SQLite μ„λ²„ λ¨λ“ μ „ν™
- API Key μΈμ¦ μ¶”κ°€
- Docker μ»¨ν…μ΄λ„ν™”

### M2 β†’ M3
- PostgreSQL λ§μ΄κ·Έλ μ΄μ…
- JWT μΈμ¦ μ‹μ¤ν…
- Docker Compose κµ¬μ„±

### M3 β†’ M4
- κ³ κ°€μ©μ„± κµ¬μ„±
- Kubernetes λ°°ν¬
- λ¨λ‹ν„°λ§ μ‹μ¤ν…