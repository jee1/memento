---
globs: *.ts,*.js,*.json
description: í”„ë¡œì íŠ¸ êµ¬ì¡° ë° íŒŒì¼ ëª…ëª… ê·œì¹™
---

# í”„ë¡œì íŠ¸ êµ¬ì¡° ê·œì¹™

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
memento/
â”œâ”€â”€ src/                    # ì†ŒìŠ¤ ì½”ë“œ
â”‚   â”œâ”€â”€ algorithms/        # ê²€ìƒ‰ ë° ë§ê° ì•Œê³ ë¦¬ì¦˜
â”‚   â”‚   â”œâ”€â”€ search-engine.ts        # ê¸°ë³¸ ê²€ìƒ‰ ì—”ì§„ (233ì¤„)
â”‚   â”‚   â”œâ”€â”€ hybrid-search-engine.ts # í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì—”ì§„ (200ì¤„)
â”‚   â”‚   â”œâ”€â”€ search-ranking.ts       # ê²€ìƒ‰ ë­í‚¹ ì•Œê³ ë¦¬ì¦˜
â”‚   â”‚   â”œâ”€â”€ forgetting-algorithm.ts # ë§ê° ì•Œê³ ë¦¬ì¦˜ (244ì¤„)
â”‚   â”‚   â””â”€â”€ spaced-repetition.ts    # ê°„ê²© ë°˜ë³µ ì•Œê³ ë¦¬ì¦˜ (239ì¤„)
â”‚   â”œâ”€â”€ client/            # MCP í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â””â”€â”€ index.ts       # í´ë¼ì´ì–¸íŠ¸ ì§„ì…ì 
â”‚   â”œâ”€â”€ config/            # ì„¤ì • ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ index.ts       # ì„¤ì • íŒŒì¼
â”‚   â”œâ”€â”€ database/          # ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨
â”‚   â”‚   â”œâ”€â”€ init.ts        # ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” (102ì¤„)
â”‚   â”‚   â””â”€â”€ schema.sql     # SQLite ìŠ¤í‚¤ë§ˆ
â”‚   â”œâ”€â”€ server/            # MCP ì„œë²„
â”‚   â”‚   â”œâ”€â”€ index.ts       # ì„œë²„ ì§„ì…ì  (521ì¤„)
â”‚   â”‚   â””â”€â”€ http-server.ts # HTTP/WebSocket ì„œë²„ (551ì¤„)
â”‚   â”œâ”€â”€ services/          # ì„œë¹„ìŠ¤ ë ˆì´ì–´ (ì‹ ê·œ)
â”‚   â”‚   â”œâ”€â”€ embedding-service.ts        # OpenAI ì„ë² ë”© ì„œë¹„ìŠ¤ (196ì¤„)
â”‚   â”‚   â”œâ”€â”€ memory-embedding-service.ts # ë©”ëª¨ë¦¬ ì„ë² ë”© ì„œë¹„ìŠ¤ (237ì¤„)
â”‚   â”‚   â””â”€â”€ forgetting-policy-service.ts # ë§ê° ì •ì±… ì„œë¹„ìŠ¤ (335ì¤„)
â”‚   â”œâ”€â”€ tools/             # MCP Tools êµ¬í˜„ (ë¹ˆ í´ë”)
â”‚   â”œâ”€â”€ types/             # TypeScript íƒ€ì… ì •ì˜
â”‚   â”‚   â””â”€â”€ index.ts       # ê³µí†µ íƒ€ì… ì •ì˜
â”‚   â”œâ”€â”€ utils/             # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”‚   â”‚   â””â”€â”€ database.ts    # ë°ì´í„°ë² ì´ìŠ¤ ìœ í‹¸ë¦¬í‹°
â”‚   â”œâ”€â”€ test-client.ts     # í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸ (152ì¤„)
â”‚   â”œâ”€â”€ test-search.ts     # ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ (152ì¤„)
â”‚   â”œâ”€â”€ test-embedding.ts  # ì„ë² ë”© í…ŒìŠ¤íŠ¸ (154ì¤„)
â”‚   â””â”€â”€ test-forgetting.ts # ë§ê° ì •ì±… í…ŒìŠ¤íŠ¸ (163ì¤„)
â”œâ”€â”€ dist/                  # ë¹Œë“œ ê²°ê³¼ë¬¼
â”‚   â”œâ”€â”€ algorithms/        # ì»´íŒŒì¼ëœ ì•Œê³ ë¦¬ì¦˜
â”‚   â”œâ”€â”€ client/           # ì»´íŒŒì¼ëœ í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ config/           # ì»´íŒŒì¼ëœ ì„¤ì •
â”‚   â”œâ”€â”€ database/         # ì»´íŒŒì¼ëœ ë°ì´í„°ë² ì´ìŠ¤
â”‚   â”œâ”€â”€ server/           # ì»´íŒŒì¼ëœ ì„œë²„
â”‚   â”œâ”€â”€ services/         # ì»´íŒŒì¼ëœ ì„œë¹„ìŠ¤ (ì‹ ê·œ)
â”‚   â”œâ”€â”€ types/            # ì»´íŒŒì¼ëœ íƒ€ì…
â”‚   â””â”€â”€ utils/            # ì»´íŒŒì¼ëœ ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ data/                 # ë°ì´í„° íŒŒì¼
â”‚   â”œâ”€â”€ memory.db         # SQLite ë°ì´í„°ë² ì´ìŠ¤
â”‚   â”œâ”€â”€ memory.db-shm     # SQLite ê³µìœ  ë©”ëª¨ë¦¬
â”‚   â””â”€â”€ memory.db-wal     # SQLite WAL íŒŒì¼
â”œâ”€â”€ docs/                 # ë¬¸ì„œ
â”œâ”€â”€ .cursor/rules/        # Cursor ê°œë°œ ê·œì¹™
â”œâ”€â”€ package.json          # í”„ë¡œì íŠ¸ ì„¤ì •
â”œâ”€â”€ tsconfig.json         # TypeScript ì„¤ì •
â”œâ”€â”€ vitest.config.ts      # Vitest ì„¤ì •
â””â”€â”€ env.example           # í™˜ê²½ ë³€ìˆ˜ ì˜ˆì‹œ
```

## ğŸ“ íŒŒì¼ ëª…ëª… ê·œì¹™

### TypeScript íŒŒì¼
- **ì»´í¬ë„ŒíŠ¸**: PascalCase (ì˜ˆ: `MemoryManager.ts`)
- **ìœ í‹¸ë¦¬í‹°**: kebab-case (ì˜ˆ: `search-ranking.ts`)
- **íƒ€ì… ì •ì˜**: `types.ts` ë˜ëŠ” `interfaces.ts`
- **ìƒìˆ˜**: `constants.ts` ë˜ëŠ” `config.ts`

### í…ŒìŠ¤íŠ¸ íŒŒì¼
- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: `*.test.ts`
- **í†µí•© í…ŒìŠ¤íŠ¸**: `*.integration.test.ts`
- **E2E í…ŒìŠ¤íŠ¸**: `*.e2e.test.ts`
- **í”½ìŠ¤ì²˜**: `*.fixture.ts`
- **í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸**: `test-*.ts` (ì˜ˆ: `test-client.ts`, `test-search.ts`)

### ì„¤ì • íŒŒì¼
- **í™˜ê²½ë³„**: `.env.development`, `.env.production`
- **ë¹Œë“œ**: `webpack.config.js`, `tsconfig.json`
- **Docker**: `Dockerfile`, `docker-compose.yml`

## ğŸ—ï¸ ëª¨ë“ˆ êµ¬ì¡°

### MCP ì„œë²„ ëª¨ë“ˆ
```typescript
// src/server/tools/remember.ts
export class RememberTool {
  async execute(params: RememberParams): Promise<RememberResult> {
    // êµ¬í˜„
  }
}

// src/server/tools/index.ts
export { RememberTool } from './remember';
export { RecallTool } from './recall';
// ... ë‹¤ë¥¸ ë„êµ¬ë“¤
```

### í´ë¼ì´ì–¸íŠ¸ ëª¨ë“ˆ
```typescript
// src/client/memory-manager.ts
export class MemoryManager {
  constructor(private client: MCPClient) {}
  
  async remember(content: string, options?: RememberOptions): Promise<string> {
    // êµ¬í˜„
  }
}
```

### ì•Œê³ ë¦¬ì¦˜ ëª¨ë“ˆ
```typescript
// src/algorithms/search-ranking.ts
export class SearchRanking {
  calculateScore(features: SearchFeatures): number {
    // êµ¬í˜„
  }
}
```

## ğŸ”— ì˜ì¡´ì„± ê´€ë¦¬

### ë‚´ë¶€ ì˜ì¡´ì„±
- **ì„œë²„ â†’ ê³µí†µ**: `src/server` â†’ `src/shared`
- **í´ë¼ì´ì–¸íŠ¸ â†’ ê³µí†µ**: `src/client` â†’ `src/shared`
- **ì•Œê³ ë¦¬ì¦˜ â†’ ê³µí†µ**: `src/algorithms` â†’ `src/shared`

### ì™¸ë¶€ ì˜ì¡´ì„±
- **MCP SDK**: `@modelcontextprotocol/sdk`
- **ë°ì´í„°ë² ì´ìŠ¤**: `better-sqlite3` (M1), `pg` (M3+)
- **ë²¡í„° ê²€ìƒ‰**: `sqlite-vss` (M1), `pgvector` (M3+)
- **í…ŒìŠ¤íŠ¸**: `jest`, `@types/jest`

## ğŸ“¦ íŒ¨í‚¤ì§€ êµ¬ì¡°

### package.json ìŠ¤í¬ë¦½íŠ¸
```json
{
  "scripts": {
    "dev": "tsx watch src/server/index.ts",
    "build": "tsc && npm run copy:assets",
    "copy:assets": "powershell -Command \"if (!(Test-Path 'dist/database')) { New-Item -ItemType Directory -Path 'dist/database' -Force }; Copy-Item 'src/database/schema.sql' 'dist/database/' -Force\"",
    "start": "node dist/server/index.js",
    "test": "vitest",
    "lint": "eslint src/**/*.ts",
    "type-check": "tsc --noEmit",
    "db:init": "tsx src/database/init.ts",
    "db:migrate": "tsx src/database/migrate.ts",
    "test:client": "tsx src/test-client.ts",
    "test:search": "tsx src/test-search.ts"
  }
}
```

### TypeScript ì„¤ì •
```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@/server/*": ["src/server/*"],
      "@/client/*": ["src/client/*"],
      "@/shared/*": ["src/shared/*"]
    }
  }
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ êµ¬ì¡°

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```typescript
// tests/unit/memory-manager.test.ts
import { MemoryManager } from '@/client/memory-manager';

describe('MemoryManager', () => {
  let memoryManager: MemoryManager;
  
  beforeEach(() => {
    // í…ŒìŠ¤íŠ¸ ì„¤ì •
  });
  
  it('should remember content', async () => {
    // í…ŒìŠ¤íŠ¸ êµ¬í˜„
  });
});
```

### í†µí•© í…ŒìŠ¤íŠ¸
```typescript
// tests/integration/mcp-server.test.ts
import { MCPClient } from '@modelcontextprotocol/sdk';

describe('MCP Server Integration', () => {
  let client: MCPClient;
  
  beforeAll(async () => {
    // ì„œë²„ ì‹œì‘
  });
  
  afterAll(async () => {
    // ì„œë²„ ì¢…ë£Œ
  });
});
```

## ğŸ³ Docker êµ¬ì¡°

### Dockerfile
```dockerfile
FROM node:20-alpine

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY dist/ ./dist/
EXPOSE 8080

CMD ["node", "dist/server/index.js"]
```

### docker-compose.yml
```yaml
version: '3.8'
services:
  memento-server:
    build: .
    ports:
      - "8080:8080"
    environment:
      - NODE_ENV=production
    volumes:
      - ./data:/app/data
```

## ğŸ“‹ ì½”ë“œ ì¡°ì§ ì›ì¹™

### 1. ë‹¨ì¼ ì±…ì„ ì›ì¹™
- ê° ëª¨ë“ˆì€ í•˜ë‚˜ì˜ ëª…í™•í•œ ì±…ì„ì„ ê°€ì ¸ì•¼ í•¨
- MCP ToolsëŠ” ê°ê° ë…ë¦½ì ì¸ íŒŒì¼ë¡œ ë¶„ë¦¬

### 2. ì˜ì¡´ì„± ì—­ì „
- êµ¬ì²´ì ì¸ êµ¬í˜„ë³´ë‹¤ëŠ” ì¶”ìƒí™”ì— ì˜ì¡´
- ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ëŠìŠ¨í•œ ê²°í•©

### 3. ì„¤ì • ë¶„ë¦¬
- í™˜ê²½ë³„ ì„¤ì •ì€ ë³„ë„ íŒŒì¼ë¡œ ê´€ë¦¬
- í•˜ë“œì½”ë”©ëœ ê°’ì€ ìƒìˆ˜ë¡œ ë¶„ë¦¬

### 4. ì—ëŸ¬ ì²˜ë¦¬
- ê° ë ˆì´ì–´ì—ì„œ ì ì ˆí•œ ì—ëŸ¬ ì²˜ë¦¬
- ì‚¬ìš©ì ì¹œí™”ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€

### 5. ë¡œê¹…
- êµ¬ì¡°í™”ëœ ë¡œê¹… ì‚¬ìš©
- ë¯¼ê°í•œ ì •ë³´ëŠ” ë§ˆìŠ¤í‚¹

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

### M1 â†’ M2
- SQLite ì„œë²„ ëª¨ë“œ ì „í™˜
- API Key ì¸ì¦ ì¶”ê°€
- Docker ì»¨í…Œì´ë„ˆí™”

### M2 â†’ M3
- PostgreSQL ë§ˆì´ê·¸ë ˆì´ì…˜
- JWT ì¸ì¦ ì‹œìŠ¤í…œ
- Docker Compose êµ¬ì„±

### M3 â†’ M4
- ê³ ê°€ìš©ì„± êµ¬ì„±
- Kubernetes ë°°í¬
- ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ