---
globs: *performance-monitoring*,*performance-alert*
description: Memento í”„ë¡œì íŠ¸ì˜ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼ ì‹œìŠ¤í…œ ê°œë°œ ê·œì¹™ì…ë‹ˆë‹¤. ì‹¤ì‹œê°„ ì„±ëŠ¥ ì¶”ì , ì„ê³„ê°’ ê¸°ë°˜ ì•Œë¦¼, ìë™ ë³µêµ¬ë¥¼ í†µí•œ ì‹œìŠ¤í…œ ì•ˆì •ì„± ë³´ì¥ì„ ìœ„í•œ ê°€ì´ë“œë¼ì¸ì„ ì œê³µí•©ë‹ˆë‹¤.
---

# ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼ ì‹œìŠ¤í…œ ê°œë°œ ê·œì¹™

## ğŸ¯ ê°œìš”

ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì€ Memento MCP Serverì˜ ì„±ëŠ¥ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì í•˜ê³ , ì„ê³„ê°’ ê¸°ë°˜ ì•Œë¦¼ì„ í†µí•´ ì‹œìŠ¤í…œ ì•ˆì •ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤. ìë™ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ì„ í†µí•´ ë¬¸ì œ ë°œìƒ ì‹œ ì¦‰ì‹œ ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
src/services/
â”œâ”€â”€ performance-monitor.ts                    # ê¸°ë³¸ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
â”œâ”€â”€ performance-alert-service.ts              # ì„±ëŠ¥ ì•Œë¦¼ ì„œë¹„ìŠ¤
â”œâ”€â”€ performance-monitoring-integration.ts     # í†µí•© ëª¨ë‹ˆí„°ë§
â””â”€â”€ test-performance-monitoring.ts            # í…ŒìŠ¤íŠ¸ íŒŒì¼
```

## ğŸ”§ í•µì‹¬ ê¸°ëŠ¥

### 1. ì‹¤ì‹œê°„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: í™ ì‚¬ìš©ëŸ‰, RSS, ì™¸ë¶€ ë©”ëª¨ë¦¬
- **CPU ì‚¬ìš©ë¥ **: í”„ë¡œì„¸ìŠ¤ CPU ì‚¬ìš©ë¥ 
- **ì‘ë‹µ ì‹œê°„**: í‰ê· /ìµœëŒ€ ì‘ë‹µ ì‹œê°„
- **ì²˜ë¦¬ëŸ‰**: ì´ˆë‹¹ ìš”ì²­ ìˆ˜
- **ì—ëŸ¬ìœ¨**: ì—ëŸ¬ ë°œìƒ ë¹„ìœ¨

### 2. ì„ê³„ê°’ ê¸°ë°˜ ì•Œë¦¼
- **ê²½ê³  ì•Œë¦¼**: ì„±ëŠ¥ ì €í•˜ ê²½ê³ 
- **ì‹¬ê° ì•Œë¦¼**: ì‹œìŠ¤í…œ ìœ„í—˜ ìƒíƒœ
- **ìë™ ë³µêµ¬**: ë¬¸ì œ ë°œìƒ ì‹œ ìë™ ëŒ€ì‘
- **ì•Œë¦¼ ê´€ë¦¬**: ì•Œë¦¼ ìƒì„±, í•´ê²°, í†µê³„

### 3. ì„±ëŠ¥ ìµœì í™”
- **ìë™ ì¸ë±ìŠ¤ ìƒì„±**: ëŠë¦° ì¿¼ë¦¬ ìµœì í™”
- **ìºì‹œ ì •ë¦¬**: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”
- **ì—°ê²° í’€ ê´€ë¦¬**: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìµœì í™”
- **ê°€ë¹„ì§€ ì»¬ë ‰ì…˜**: ë©”ëª¨ë¦¬ ì •ë¦¬

## ğŸ› ï¸ ê°œë°œ ê°€ì´ë“œë¼ì¸

### ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤
```typescript
interface PerformanceMonitor {
  // ë©”íŠ¸ë¦­ ìˆ˜ì§‘
  collectMetrics(): Promise<PerformanceMetrics>;
  
  // ì„±ëŠ¥ ì²´í¬
  checkPerformance(): Promise<PerformanceStatus>;
  
  // ë©”íŠ¸ë¦­ ê¸°ë¡
  recordMetric(name: string, value: number, tags?: Record<string, string>): void;
  
  // ì„±ëŠ¥ ë¦¬í¬íŠ¸ ìƒì„±
  generateReport(timeRange: string): Promise<PerformanceReport>;
}
```

### ì„±ëŠ¥ ì•Œë¦¼ ì„œë¹„ìŠ¤
```typescript
interface PerformanceAlertService {
  // ì•Œë¦¼ ìƒì„±
  createAlert(
    level: AlertLevel,
    type: AlertType,
    metric: string,
    value: number,
    threshold: number,
    message: string,
    context?: Record<string, any>
  ): PerformanceAlert;
  
  // ì•Œë¦¼ í•´ê²°
  resolveAlert(alertId: string, resolvedBy: string, resolution?: string): PerformanceAlert | null;
  
  // í™œì„± ì•Œë¦¼ ì¡°íšŒ
  getActiveAlerts(): PerformanceAlert[];
  
  // ì•Œë¦¼ í†µê³„
  getStats(): AlertStats;
}
```

### ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ í†µí•©
```typescript
interface PerformanceMonitoringIntegration {
  // ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œì‘
  startRealTimeMonitoring(): void;
  
  // ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€
  stopRealTimeMonitoring(): void;
  
  // ì„±ëŠ¥ ì²´í¬
  private checkPerformance(): Promise<void>;
  
  // ì„ê³„ê°’ í™•ì¸
  private checkResponseTime(avgResponseTime: number): void;
  private checkMemoryUsage(heapUsedMB: number): void;
  private checkErrorRate(errorRate: number): void;
  private checkThroughput(throughput: number): void;
}
```

## ğŸ“Š ì„±ëŠ¥ ë©”íŠ¸ë¦­

### ê¸°ë³¸ ë©”íŠ¸ë¦­
```typescript
interface PerformanceMetrics {
  memory: {
    usage: number;        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (MB)
    heapUsed: number;     // í™ ì‚¬ìš©ëŸ‰ (MB)
    heapTotal: number;    // í™ ì´ëŸ‰ (MB)
    rss: number;          // RSS ë©”ëª¨ë¦¬ (MB)
    external: number;     // ì™¸ë¶€ ë©”ëª¨ë¦¬ (MB)
  };
  
  cpu: {
    usage: number;        // CPU ì‚¬ìš©ë¥  (%)
    loadAverage: number[]; // ë¡œë“œ í‰ê· 
  };
  
  database: {
    totalMemories: number;        // ì´ ë©”ëª¨ë¦¬ ìˆ˜
    memoryByType: Record<string, number>; // íƒ€ì…ë³„ ë©”ëª¨ë¦¬ ìˆ˜
    averageMemorySize: number;    // í‰ê·  ë©”ëª¨ë¦¬ í¬ê¸°
    databaseSize: number;         // ë°ì´í„°ë² ì´ìŠ¤ í¬ê¸°
    queryPerformance: {
      averageQueryTime: number;   // í‰ê·  ì¿¼ë¦¬ ì‹œê°„
      slowQueries: Array<{        // ëŠë¦° ì¿¼ë¦¬
        query: string;
        time: number;
        count: number;
      }>;
    };
  };
  
  search: {
    totalSearches: number;        // ì´ ê²€ìƒ‰ ìˆ˜
    averageSearchTime: number;    // í‰ê·  ê²€ìƒ‰ ì‹œê°„
    cacheHitRate: number;         // ìºì‹œ íˆíŠ¸ìœ¨
    embeddingSearchRate: number;  // ì„ë² ë”© ê²€ìƒ‰ ë¹„ìœ¨
  };
  
  system: {
    uptime: number;               // ì—…íƒ€ì„ (ì´ˆ)
    cpuUsage: number;             // CPU ì‚¬ìš©ë¥ 
    loadAverage: number[];        // ë¡œë“œ í‰ê· 
  };
}
```

### ì•Œë¦¼ ì„ê³„ê°’
```typescript
interface AlertThresholds {
  responseTime: {
    warning: number;    // ê²½ê³  ì„ê³„ê°’ (ms)
    critical: number;   // ì‹¬ê° ì„ê³„ê°’ (ms)
  };
  memoryUsage: {
    warning: number;    // ê²½ê³  ì„ê³„ê°’ (MB)
    critical: number;   // ì‹¬ê° ì„ê³„ê°’ (MB)
  };
  errorRate: {
    warning: number;    // ê²½ê³  ì„ê³„ê°’ (%)
    critical: number;   // ì‹¬ê° ì„ê³„ê°’ (%)
  };
  throughput: {
    warning: number;    // ê²½ê³  ì„ê³„ê°’ (ops/sec)
    critical: number;   // ì‹¬ê° ì„ê³„ê°’ (ops/sec)
  };
}
```

## ğŸš¨ ì•Œë¦¼ ì‹œìŠ¤í…œ

### ì•Œë¦¼ ë ˆë²¨
```typescript
enum AlertLevel {
  INFO = 'INFO',         // ì •ë³´ì„± ì•Œë¦¼
  WARNING = 'WARNING',   // ê²½ê³  ì•Œë¦¼
  CRITICAL = 'CRITICAL'  // ì‹¬ê° ì•Œë¦¼
}
```

### ì•Œë¦¼ íƒ€ì…
```typescript
enum AlertType {
  RESPONSE_TIME = 'response_time',    // ì‘ë‹µ ì‹œê°„
  MEMORY_USAGE = 'memory_usage',      // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
  ERROR_RATE = 'error_rate',          // ì—ëŸ¬ìœ¨
  THROUGHPUT = 'throughput',          // ì²˜ë¦¬ëŸ‰
  CUSTOM = 'custom'                   // ì‚¬ìš©ì ì •ì˜
}
```

### ì•Œë¦¼ ìƒì„± ì˜ˆì‹œ
```typescript
// ì‘ë‹µ ì‹œê°„ ì•Œë¦¼
const alert = alertService.createAlert(
  AlertLevel.WARNING,
  AlertType.RESPONSE_TIME,
  'í‰ê·  ì‘ë‹µì‹œê°„',
  150,
  100,
  'ğŸŸ¡ ì‘ë‹µì‹œê°„ì´ ì„ê³„ê°’ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤',
  { component: 'search_engine', operation: 'search' }
);

// ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì•Œë¦¼
const alert = alertService.createAlert(
  AlertLevel.CRITICAL,
  AlertType.MEMORY_USAGE,
  'í™ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰',
  200,
  150,
  'ğŸ”´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ìœ„í—˜ ìˆ˜ì¤€ì…ë‹ˆë‹¤',
  { component: 'memory_manager', operation: 'create_memory' }
);
```

## ğŸ”„ ìë™ ë³µêµ¬ ì‹œìŠ¤í…œ

### ë³µêµ¬ ì „ëµ
```typescript
interface RecoveryStrategy {
  // ë©”ëª¨ë¦¬ ì •ë¦¬
  cleanupMemory(): Promise<void>;
  
  // ìºì‹œ ì •ë¦¬
  clearCache(): Promise<void>;
  
  // ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
  optimizeDatabase(): Promise<void>;
  
  // ì—°ê²° í’€ ì¬ì‹œì‘
  restartConnectionPool(): Promise<void>;
}
```

### ìë™ ë³µêµ¬ ì‹¤í–‰
```typescript
// ì‹¬ê°í•œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì‹œ ìë™ ë³µêµ¬
if (heapUsedMB > criticalThreshold) {
  console.log('ğŸ”´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ìœ„í—˜ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ìë™ ë³µêµ¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...');
  
  await recoveryStrategy.cleanupMemory();
  await recoveryStrategy.clearCache();
  
  console.log('âœ… ìë™ ë³µêµ¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ì´ë“œë¼ì¸

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```typescript
describe('PerformanceMonitor', () => {
  let monitor: PerformanceMonitor;
  
  beforeEach(() => {
    monitor = new PerformanceMonitor();
  });
  
  it('should collect memory metrics', async () => {
    const metrics = await monitor.collectMetrics();
    
    expect(metrics.memory.heapUsed).toBeGreaterThan(0);
    expect(metrics.memory.rss).toBeGreaterThan(0);
  });
  
  it('should detect performance issues', async () => {
    // ì„±ëŠ¥ ì €í•˜ ì‹œë®¬ë ˆì´ì…˜
    await simulateHighMemoryUsage();
    
    const status = await monitor.checkPerformance();
    expect(status.hasIssues).toBe(true);
  });
});
```

### í†µí•© í…ŒìŠ¤íŠ¸
```typescript
describe('PerformanceMonitoring Integration', () => {
  it('should create alerts when thresholds exceeded', async () => {
    const monitoring = new PerformanceMonitoringIntegration(
      db,
      alertService,
      { enableRealTimeMonitoring: true }
    );
    
    // ì„ê³„ê°’ ì´ˆê³¼ ì‹œë®¬ë ˆì´ì…˜
    await simulateHighResponseTime();
    
    // ì•Œë¦¼ ìƒì„± í™•ì¸
    const alerts = alertService.getActiveAlerts();
    expect(alerts.length).toBeGreaterThan(0);
    expect(alerts[0].type).toBe(AlertType.RESPONSE_TIME);
  });
});
```

## ğŸ“ˆ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

### ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­
- **ì‹œìŠ¤í…œ ìƒíƒœ**: CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ ì‚¬ìš©ë¥ 
- **ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥**: ì‘ë‹µ ì‹œê°„, ì²˜ë¦¬ëŸ‰, ì—ëŸ¬ìœ¨
- **ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥**: ì¿¼ë¦¬ ì‹œê°„, ì—°ê²° ìˆ˜, ì¸ë±ìŠ¤ ì‚¬ìš©ë¥ 
- **ê²€ìƒ‰ ì„±ëŠ¥**: ê²€ìƒ‰ ì‹œê°„, ìºì‹œ íˆíŠ¸ìœ¨, ì„ë² ë”© ìƒì„±ë¥ 

### ì•Œë¦¼ ê´€ë¦¬
- **í™œì„± ì•Œë¦¼**: í˜„ì¬ ë°œìƒí•œ ì•Œë¦¼ ëª©ë¡
- **ì•Œë¦¼ í†µê³„**: ì•Œë¦¼ ë°œìƒ ë¹ˆë„, í•´ê²° ì‹œê°„
- **ì•Œë¦¼ ì„¤ì •**: ì„ê³„ê°’ ì¡°ì •, ì•Œë¦¼ ì±„ë„ ì„¤ì •

## ğŸš€ ë°°í¬ ê³ ë ¤ì‚¬í•­

### í™˜ê²½ ë³€ìˆ˜
```bash
# ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì„¤ì •
PERFORMANCE_MONITORING_ENABLED=true
PERFORMANCE_MONITORING_INTERVAL=30000
PERFORMANCE_ALERT_ENABLED=true
PERFORMANCE_ALERT_WEBHOOK_URL=https://hooks.slack.com/...
```

### ëª¨ë‹ˆí„°ë§ ë„êµ¬
- **Prometheus**: ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- **Grafana**: ëŒ€ì‹œë³´ë“œ ì‹œê°í™”
- **AlertManager**: ì•Œë¦¼ ê´€ë¦¬
- **Jaeger**: ë¶„ì‚° ì¶”ì 

### ì„±ëŠ¥ ìµœì í™”
- **ë©”íŠ¸ë¦­ ìƒ˜í”Œë§**: ë¶ˆí•„ìš”í•œ ë©”íŠ¸ë¦­ ì œê±°
- **ì••ì¶•**: ì˜¤ë˜ëœ ë©”íŠ¸ë¦­ ì••ì¶• ì €ì¥
- **ë°°ì¹˜ ì²˜ë¦¬**: ì—¬ëŸ¬ ë©”íŠ¸ë¦­ì„ í•œ ë²ˆì— ì²˜ë¦¬

## ğŸ“š ì°¸ê³  ìë£Œ

- [Node.js Performance Monitoring](https://nodejs.org/api/perf_hooks.html)
- [Prometheus Metrics](https://prometheus.io/docs/concepts/metric_types/)
- [Grafana Dashboards](https://grafana.com/docs/grafana/latest/dashboards/)
- [Performance Monitoring Best Practices](https://www.datadoghq.com/blog/monitoring-101-alerting/)