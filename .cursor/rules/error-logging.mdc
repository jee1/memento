---
globs: "src/services/error-logging-service.ts,src/tools/error-stats.ts,src/tools/resolve-error.ts,src/test-error-logging.ts"
description: ì—ëŸ¬ ë¡œê¹… ì‹œìŠ¤í…œ ê°œë°œ ê·œì¹™
---

# ì—ëŸ¬ ë¡œê¹… ì‹œìŠ¤í…œ ê°œë°œ ê·œì¹™

## ğŸ“‹ ì—ëŸ¬ ë¡œê¹… ì‹œìŠ¤í…œ ê°œìš”

### í˜„ì¬ êµ¬í˜„ ìƒíƒœ
- **ì—ëŸ¬ ë¡œê¹… ì„œë¹„ìŠ¤**: `src/services/error-logging-service.ts`
- **ì—ëŸ¬ í†µê³„ ë„êµ¬**: `src/tools/error-stats.ts`
- **ì—ëŸ¬ í•´ê²° ë„êµ¬**: `src/tools/resolve-error.ts`
- **ì—ëŸ¬ ë¡œê¹… í…ŒìŠ¤íŠ¸**: `src/test-error-logging.ts`

### í•µì‹¬ ì¸í„°í˜ì´ìŠ¤

```typescript
interface ErrorLoggingService {
  // ì—ëŸ¬ ë¡œê¹…
  logError(error: Error, severity: ErrorSeverity, category: ErrorCategory, context?: Record<string, any>): void;
  
  // ì—ëŸ¬ í†µê³„ ì¡°íšŒ
  getErrorStats(filters?: ErrorFilters): Promise<ErrorStats>;
  
  // ì—ëŸ¬ í•´ê²°
  resolveError(errorId: string, resolvedBy: string, resolution?: string): Promise<boolean>;
  
  // ì—ëŸ¬ ê²€ìƒ‰
  searchErrors(filters: ErrorSearchFilters): Promise<ErrorLog[]>;
}

enum ErrorSeverity {
  LOW = 'LOW',
  MEDIUM = 'MEDIUM',
  HIGH = 'HIGH',
  CRITICAL = 'CRITICAL'
}

enum ErrorCategory {
  UNKNOWN = 'UNKNOWN',
  DATABASE = 'DATABASE',
  NETWORK = 'NETWORK',
  TOOL_EXECUTION = 'TOOL_EXECUTION',
  VALIDATION = 'VALIDATION',
  SYSTEM = 'SYSTEM'
}
```

## ğŸ”§ ì—ëŸ¬ ë¡œê¹… ì„œë¹„ìŠ¤ êµ¬í˜„

### 1. ì—ëŸ¬ ë¡œê¹… ë©”ì„œë“œ

```typescript
export class ErrorLoggingService {
  private errors: Map<string, ErrorLog> = new Map();
  private logDirectory: string;
  private maxErrors = 1000; // ìµœëŒ€ ì €ì¥ ì—ëŸ¬ ìˆ˜

  constructor(logDirectory: string = './logs') {
    this.logDirectory = logDirectory;
    if (!existsSync(this.logDirectory)) {
      mkdirSync(this.logDirectory, { recursive: true });
    }
  }

  /**
   * ì—ëŸ¬ë¥¼ ë¡œê¹…í•©ë‹ˆë‹¤.
   */
  logError(
    error: Error,
    severity: ErrorSeverity,
    category: ErrorCategory,
    context?: Record<string, any>
  ): void {
    const id = uuidv4();
    const errorLog: ErrorLog = {
      id,
      message: error.message,
      stack: error.stack,
      severity,
      category,
      context,
      timestamp: new Date(),
      resolved: false
    };

    this.errors.set(id, errorLog);
    this.cleanupOldErrors();
    this.logToFile(errorLog);
    this.logToConsole(errorLog);
  }
}
```

### 2. ì—ëŸ¬ í†µê³„ ìˆ˜ì§‘

```typescript
/**
   * ì—ëŸ¬ í†µê³„ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
   */
  getErrorStats(filters?: ErrorFilters): ErrorStats {
    let filteredErrors = Array.from(this.errors.values());

    // í•„í„° ì ìš©
    if (filters?.severity) {
      filteredErrors = filteredErrors.filter(e => e.severity === filters.severity);
    }
    if (filters?.category) {
      filteredErrors = filteredErrors.filter(e => e.category === filters.category);
    }
    if (filters?.hours) {
      const cutoffTime = new Date(Date.now() - filters.hours * 60 * 60 * 1000);
      filteredErrors = filteredErrors.filter(e => e.timestamp >= cutoffTime);
    }

    // í†µê³„ ê³„ì‚°
    const total = filteredErrors.length;
    const bySeverity: Record<string, number> = {};
    const byCategory: Record<string, number> = {};
    const resolved = filteredErrors.filter(e => e.resolved).length;

    filteredErrors.forEach(error => {
      bySeverity[error.severity] = (bySeverity[error.severity] || 0) + 1;
      byCategory[error.category] = (byCategory[error.category] || 0) + 1;
    });

    return {
      total,
      resolved,
      active: total - resolved,
      bySeverity,
      byCategory,
      recentErrors: filteredErrors
        .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())
        .slice(0, filters?.limit || 10)
    };
  }
```

### 3. ì—ëŸ¬ í•´ê²° ì²˜ë¦¬

```typescript
/**
   * íŠ¹ì • ì—ëŸ¬ë¥¼ í•´ê²° ìƒíƒœë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
   */
  resolveError(errorId: string, resolvedBy: string, resolution?: string): boolean {
    const error = this.errors.get(errorId);
    if (error) {
      error.resolved = true;
      error.resolvedAt = new Date();
      error.resolvedBy = resolvedBy;
      error.resolution = resolution;
      
      console.log(`[INFO] ì—ëŸ¬ í•´ê²°ë¨: ${errorId} by ${resolvedBy}`);
      this.logToFile(error); // í•´ê²°ëœ ìƒíƒœë¡œ ë‹¤ì‹œ ë¡œê¹…
      return true;
    }
    return false;
  }
```

## ğŸ› ï¸ MCP ë„êµ¬ êµ¬í˜„

### 1. error_stats ë„êµ¬

```typescript
export const errorStatsTool: ToolDefinition = {
  name: 'error_stats',
  description: 'ì—ëŸ¬ í†µê³„ë¥¼ ì¡°íšŒí•˜ê³  í•„í„°ë§ëœ ì—ëŸ¬ ë¡œê·¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.',
  inputSchema: z.object({
    severity: z.nativeEnum(ErrorSeverity).optional().describe('ì¡°íšŒí•  ì—ëŸ¬ì˜ ì‹¬ê°ë„ (LOW, MEDIUM, HIGH, CRITICAL).'),
    category: z.nativeEnum(ErrorCategory).optional().describe('ì¡°íšŒí•  ì—ëŸ¬ì˜ ì¹´í…Œê³ ë¦¬ (UNKNOWN, DATABASE, NETWORK, TOOL_EXECUTION, VALIDATION, SYSTEM).'),
    hours: z.number().min(1).optional().describe('ì§€ë‚œ ëª‡ ì‹œê°„ ë™ì•ˆì˜ ì—ëŸ¬ë¥¼ ì¡°íšŒí• ì§€ ì§€ì •í•©ë‹ˆë‹¤.'),
    limit: z.number().min(1).max(100).optional().default(10).describe('ë°˜í™˜í•  ì—ëŸ¬ ë¡œê·¸ì˜ ìµœëŒ€ ê°œìˆ˜.'),
  }),
  handler: async (params: z.infer<typeof errorStatsTool.inputSchema>, context: ToolContext) => {
    return executeErrorStats(params, context);
  },
};
```

### 2. resolve_error ë„êµ¬

```typescript
export const resolveErrorTool: ToolDefinition = {
  name: 'resolve_error',
  description: 'íŠ¹ì • ì—ëŸ¬ë¥¼ í•´ê²° ìƒíƒœë¡œ í‘œì‹œí•©ë‹ˆë‹¤.',
  inputSchema: z.object({
    error_id: z.string().min(1).describe('í•´ê²°í•  ì—ëŸ¬ì˜ ê³ ìœ  ID.'),
    resolved_by: z.string().optional().default('system').describe('ì—ëŸ¬ë¥¼ í•´ê²°í•œ ì£¼ì²´.'),
    resolution: z.string().optional().describe('ì—ëŸ¬ í•´ê²°ì— ëŒ€í•œ ì„¤ëª….'),
  }),
  handler: async (params: z.infer<typeof resolveErrorTool.inputSchema>, context: ToolContext) => {
    return executeResolveError(params, context);
  },
};
```

## ğŸ“Š ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§

### 1. íŒŒì¼ ë¡œê¹…

```typescript
private logToFile(error: ErrorLog): void {
  const date = error.timestamp.toISOString().split('T')[0];
  const logFilePath = join(this.logDirectory, `errors-${date}.jsonl`);
  appendFileSync(logFilePath, JSON.stringify(error) + '\n');
}
```

### 2. ì½˜ì†” ë¡œê¹…

```typescript
private logToConsole(error: ErrorLog): void {
  let color = '';
  switch (error.severity) {
    case ErrorSeverity.LOW:
      color = '\x1b[32m'; // Green
      break;
    case ErrorSeverity.MEDIUM:
      color = '\x1b[33m'; // Yellow
      break;
    case ErrorSeverity.HIGH:
      color = '\x1b[31m'; // Red
      break;
    case ErrorSeverity.CRITICAL:
      color = '\x1b[35m'; // Magenta
      break;
  }
  const resetColor = '\x1b[0m';
  console.error(`${color}[${error.severity}] ${error.category}${resetColor}\n  ID: ${error.id}\n  Message: ${error.message}\n  Time: ${error.timestamp.toISOString()}\n  Context: ${JSON.stringify(error.context, null, 2)}\n`);
}
```

### 3. ì˜¤ë˜ëœ ì—ëŸ¬ ì •ë¦¬

```typescript
private cleanupOldErrors(): void {
  if (this.errors.size > this.maxErrors) {
    const sortedErrors = Array.from(this.errors.values())
      .sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());
    
    for (let i = 0; i < this.errors.size - this.maxErrors; i++) {
      this.errors.delete(sortedErrors[i].id);
    }
  }
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‘ì„±

### 1. ì—ëŸ¬ ë¡œê¹… í…ŒìŠ¤íŠ¸

```typescript
// src/test-error-logging.ts
import { ErrorLoggingService, ErrorSeverity, ErrorCategory } from './services/error-logging-service.js';

async function testErrorLogging() {
  console.log('ğŸš¨ ì—ëŸ¬ ë¡œê¹… ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘');
  
  const errorService = new ErrorLoggingService('./logs');
  
  // 1. ë‹¤ì–‘í•œ ì‹¬ê°ë„ì˜ ì—ëŸ¬ ë¡œê¹…
  errorService.logError(
    new Error('Low severity test error'),
    ErrorSeverity.LOW,
    ErrorCategory.SYSTEM,
    { test: true, iteration: 1 }
  );
  
  errorService.logError(
    new Error('High severity test error'),
    ErrorSeverity.HIGH,
    ErrorCategory.DATABASE,
    { test: true, iteration: 2 }
  );
  
  // 2. ì—ëŸ¬ í†µê³„ ì¡°íšŒ
  const stats = errorService.getErrorStats();
  console.log('ğŸ“Š ì—ëŸ¬ í†µê³„:', stats);
  
  // 3. ì—ëŸ¬ í•´ê²° í…ŒìŠ¤íŠ¸
  const errors = errorService.searchErrors({ limit: 1 });
  if (errors.length > 0) {
    const resolved = errorService.resolveError(
      errors[0].id,
      'test_user',
      'í…ŒìŠ¤íŠ¸ í•´ê²°'
    );
    console.log('âœ… ì—ëŸ¬ í•´ê²°:', resolved);
  }
}
```

## ğŸ“‹ ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì—ëŸ¬ ë¡œê¹… ì„œë¹„ìŠ¤
- [ ] ErrorLoggingService í´ë˜ìŠ¤ êµ¬í˜„
- [ ] ì—ëŸ¬ ì‹¬ê°ë„ ë° ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜
- [ ] ì—ëŸ¬ í†µê³„ ìˆ˜ì§‘ ë° ë¶„ì„
- [ ] ì—ëŸ¬ í•´ê²° ì¶”ì  ì‹œìŠ¤í…œ
- [ ] íŒŒì¼ ë° ì½˜ì†” ë¡œê¹…
- [ ] ì˜¤ë˜ëœ ì—ëŸ¬ ìë™ ì •ë¦¬

### MCP ë„êµ¬
- [ ] error_stats ë„êµ¬ êµ¬í˜„
- [ ] resolve_error ë„êµ¬ êµ¬í˜„
- [ ] ë„êµ¬ ë“±ë¡ ë° í†µí•©
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ë° ê²€ì¦

### í…ŒìŠ¤íŠ¸
- [ ] ì—ëŸ¬ ë¡œê¹… í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ êµ¬í˜„
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ êµ¬í˜„
- [ ] ì—ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

### ëª¨ë‹ˆí„°ë§
- [ ] ì‹¤ì‹œê°„ ì—ëŸ¬ ëª¨ë‹ˆí„°ë§
- [ ] ì—ëŸ¬ íŒ¨í„´ ë¶„ì„
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ ì—°ë™
- [ ] ëŒ€ì‹œë³´ë“œ í†µí•©